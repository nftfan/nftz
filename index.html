<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy NFT on Polygon</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Buy NFT on Polygon</h1>
    <form id="buyForm">
        <label for="tokenId">Token ID:</label>
        <input type="number" id="tokenId" required><br>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" required><br>
        <button type="submit">Buy NFT</button>
    </form>

    <script>
        // Define contract details
        const contractAddress = '0xDb0579C6fb9e8595596EF07534017F9D830AdaF6';
        const abi = [
            "function buyNFT(uint256 _tokenId, uint256 _amount) external payable",
            "function tokenPrice() external view returns (uint256)"
        ];

        async function init() {
            // Check if MetaMask is installed
            if (window.ethereum) {
                // Connect to Polygon network
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const polygonProvider = new ethers.providers.JsonRpcProvider('https://polygon-rpc.com/'); // Polygon RPC URL

                // Set up the contract with the Polygon provider
                const contract = new ethers.Contract(contractAddress, abi, polygonProvider);

                // Request account access if needed
                await provider.send('eth_requestAccounts', []);

                // Handle form submission
                document.getElementById('buyForm').addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const tokenId = parseInt(document.getElementById('tokenId').value);
                    const amount = parseInt(document.getElementById('amount').value);

                    try {
                        const signer = provider.getSigner();
                        const contractWithSigner = contract.connect(signer);

                        // Fetch token price
                        const pricePerToken = await contractWithSigner.tokenPrice();
                        const totalPrice = pricePerToken.mul(amount);

                        // Send transaction
                        const tx = await contractWithSigner.buyNFT(tokenId, amount, { value: totalPrice });
                        await tx.wait();  // Wait for transaction to be mined

                        alert('Transaction successful!');
                    } catch (error) {
                        console.error(error);
                        alert('Transaction failed!');
                    }
                });
            } else {
                alert('MetaMask is not installed. Please install MetaMask and try again.');
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
