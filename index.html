<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy NFT on Polygon</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center; /* Center the content */
        }
        #nftImage {
            width: 400px;
            height: 400px;
            object-fit: cover; /* Ensures image covers the box */
            border: 1px solid #ddd; /* Optional border for better visibility */
            border-radius: 8px; /* Optional rounded corners */
            margin-bottom: 20px; /* Space between image and button */
        }
        #buyForm {
            display: none; /* Hide form by default */
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Buy NFT on Polygon</h1>
    <img id="nftImage" src="https://pbs.twimg.com/media/GWSh6jFWkAARGmN?format=jpg&name=medium" alt="NFT Image">
    <button id="connectWalletButton">Connect Wallet</button>
    <p id="walletAddress">Not connected</p>
    <form id="buyForm">
        <input type="hidden" id="tokenId" value="1">
        <input type="hidden" id="amount" value="1">
        <button type="submit">Buy NFT</button>
    </form>

    <script>
        // Define contract details
        const contractAddress = '0xF12FfD266DCB37F176cedDD043b3546d4CA288e2'; // Replace with your contract address
        const abi = [
            "function buyNFT(uint256 _tokenId, uint256 _amount) external payable",
            "function tokenPrice() external view returns (uint256)"
        ];

        let provider;
        let contract;
        let signer;

        async function connectWallet() {
            if (window.ethereum) {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send('eth_requestAccounts', []);
                    signer = provider.getSigner();
                    const address = await signer.getAddress();
                    document.getElementById('walletAddress').innerText = `Connected: ${address}`;
                    document.getElementById('buyForm').style.display = 'block'; // Show the buy form
                    contract = new ethers.Contract(contractAddress, abi, signer);
                } catch (error) {
                    console.error('Failed to connect wallet:', error);
                    alert('Failed to connect wallet. Check the console for details.');
                }
            } else {
                alert('MetaMask is not installed. Please install MetaMask and try again.');
            }
        }

        async function handleSubmit(event) {
            event.preventDefault();

            const tokenId = parseInt(document.getElementById('tokenId').value, 10);
            const amount = parseInt(document.getElementById('amount').value, 10);

            try {
                // Fetch token price
                const pricePerToken = await contract.tokenPrice();
                const totalPrice = pricePerToken.mul(amount);

                // Send transaction
                const tx = await contract.buyNFT(tokenId, amount, { value: totalPrice });
                await tx.wait();  // Wait for transaction to be mined

                alert('Transaction successful!');
            } catch (error) {
                console.error('Transaction error:', error);
                alert('Transaction failed! Check the console for details.');
            }
        }

        // Initialize the app
        function init() {
            document.getElementById('connectWalletButton').addEventListener('click', connectWallet);
            document.getElementById('buyForm').addEventListener('submit', handleSubmit);
        }

        init();
    </script>
</body>
</html>
